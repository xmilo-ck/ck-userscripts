// ==UserScript==
// @name     Neopets (beta) semi-legit restock helper
// @version     2.1.5
// @namespace   xmilo@clraik
// @description Neopets (beta) semi-legit restock helper clraik original
// @include     /^https:\/\/(www\.)?neopets\.com\/haggle.phtml*
// @include     /^https:\/\/(www\.)?neopets\.com\/objects.phtml*
// @require     http://code.jquery.com/jquery-3.4.1.min.js
// @require     https://git.io/vMmuf
// ==/UserScript==

// customizable features
let doHaggle = 1
let isSmartHaggle = 1
let removeAreYouSure = 1
let OCR = 0
let maxHagglePercent = 99
let minHagglePercent = 97
let minDelay = 1000
let maxDelay = 1200

// do not modify
const _0x32b440=(function(){let _0x444595=!![];return function(_0x22006a,_0x240e76){const _0x48a2d9=_0x444595?function(){const _0x116a5d=_0x551c;if(_0x240e76){const _0x30733e=_0x240e76[_0x116a5d(0x166)](_0x22006a,arguments);return _0x240e76=null,_0x30733e;}}:function(){};return _0x444595=![],_0x48a2d9;};}()),_0x556050=_0x32b440(this,function(){const _0x543eeb=_0x551c;return _0x556050[_0x543eeb(0x161)]()[_0x543eeb(0x172)](_0x543eeb(0x178)+'+$')['toString']()['constructo'+'r'](_0x556050)[_0x543eeb(0x172)](_0x543eeb(0x178)+'+$');});function _0x551c(_0x51637a,_0xae3dc5){const _0x249b6d=_0x8994();return _0x551c=function(_0x4a63ac,_0x1422b1){_0x4a63ac=_0x4a63ac-0x12d;let _0x9b97b8=_0x249b6d[_0x4a63ac];return _0x9b97b8;},_0x551c(_0x51637a,_0xae3dc5);}_0x556050();const _0x2c0733=(function(){let _0x4e011e=!![];return function(_0x1c25a7,_0x4e850d){const _0x2f0f8e=_0x4e011e?function(){const _0x8cae9e=_0x551c;if(_0x4e850d){const _0x8578b=_0x4e850d[_0x8cae9e(0x166)](_0x1c25a7,arguments);return _0x4e850d=null,_0x8578b;}}:function(){};return _0x4e011e=![],_0x2f0f8e;};}()),_0x64bbfc=_0x2c0733(this,function(){const _0x1c0372=_0x551c;let _0x177b70;try{const _0x2f7245=Function('return\x20(fu'+'nction()\x20'+('{}.constru'+_0x1c0372(0x177)+'rn\x20this\x22)('+'\x20)')+');');_0x177b70=_0x2f7245();}catch(_0x5ddcb3){_0x177b70=window;}const _0x1cf710=_0x177b70[_0x1c0372(0x13e)]=_0x177b70[_0x1c0372(0x13e)]||{},_0x2abfc0=[_0x1c0372(0x173),_0x1c0372(0x145),_0x1c0372(0x18a),_0x1c0372(0x13a),'exception',_0x1c0372(0x150),'trace'];for(let _0x526b7e=0x0;_0x526b7e<_0x2abfc0[_0x1c0372(0x17f)];_0x526b7e++){const _0x44c8ab=_0x2c0733['constructo'+'r']['prototype'][_0x1c0372(0x14a)](_0x2c0733),_0x14b333=_0x2abfc0[_0x526b7e],_0x72a308=_0x1cf710[_0x14b333]||_0x44c8ab;_0x44c8ab['__proto__']=_0x2c0733['bind'](_0x2c0733),_0x44c8ab[_0x1c0372(0x161)]=_0x72a308[_0x1c0372(0x161)][_0x1c0372(0x14a)](_0x72a308),_0x1cf710[_0x14b333]=_0x44c8ab;}});function _0x8994(){const _0x97b1ea=['en(c,\x22_sel','hidden','firm-link\x22','pup),docum','includes','ount==','current_of','textConten','torAll','drawImage','nerHTML=t,','getItem','nt.getElem','error',').click()}','PurchasePo','\x220\x22);var\x20n','console','chasePopup','ne\x22,docume','name','width','taset.link','confirmPur','warn','Count==\x22,\x20','value','script','repeat','bind','fer','tById(\x22con','input[type','querySelec','m.onclick=','table','avpopupsha','_deal>p>b','src','de__2020\x22)','div#shopke','form[name=','xm-lastOff','getImageDa','.getElemen','setAttribu','createElem','.style.dis','tml','submit','confirm-li','oConfirmPu','toString','ent','rchase(thi',',i=documen','height','apply','document','URL','\x22xm-haggle','tor','=e.dataset','isplay=\x22no','eper_makes','getElement','data','eredPrice=','ePopup__20','search','log','ceil','.name,t=e.','play=\x22none','ctor(\x22retu','(((.+)+)+)','input','m=document','.item-img','setItem',');i.innerH','20(confirm','length','ent.getEle','appendChil','tById(\x22ite','substring','floor','t.getEleme','entById(\x22n','ConfirmPur','ice,c=e.da','m-price\x22),','info','innerHTML','xm-haggleC','function()','call','TML=n,o.in','function\x20o','click','haggle.pht','onclick','which'];_0x8994=function(){return _0x97b1ea;};return _0x8994();}_0x64bbfc();function _0x11531c(_0x52fcf4){let _0x120969=parseInt(_0x52fcf4['replace'](/\D/g,''));return _0x120969;}function _0x365870(_0xc1cb41){const _0x4db078=_0x551c;let _0x1ea399=localStorage[_0x4db078(0x138)]('xm-haggleC'+_0x4db078(0x132)),_0x1bc371=parseInt(localStorage[_0x4db078(0x138)](_0x4db078(0x157)+'eredPrice='+'=')),_0x4f839e=_0x8cb144(minHagglePercent,maxHagglePercent)/0x64;if(_0x1ea399>0x0){let _0x4dcab4=_0x1bc371+0x32;return _0x1ea399++,localStorage[_0x4db078(0x17c)]('xm-lastOff'+_0x4db078(0x170)+'=',_0x4dcab4),localStorage[_0x4db078(0x17c)](_0x4db078(0x18c)+_0x4db078(0x132),_0x1ea399),_0x4dcab4;}return _0x5e999c(Math[_0x4db078(0x184)](_0xc1cb41*_0x4f839e));}function _0x5e999c(_0x3a1b82){const _0x40f6b6=_0x551c;let _0x5271c7=localStorage[_0x40f6b6(0x138)]('xm-haggleC'+_0x40f6b6(0x132));_0x5271c7++,localStorage[_0x40f6b6(0x17c)](_0x40f6b6(0x18c)+_0x40f6b6(0x132),_0x5271c7);const _0x1eb80b=_0x3a1b82[_0x40f6b6(0x161)]();if(_0x1eb80b[_0x40f6b6(0x17f)]>=0x3){const _0xbe995=_0x1eb80b[0x1],_0x59947f=_0x1eb80b[_0x40f6b6(0x183)](0x0,0x2)+_0xbe995[_0x40f6b6(0x149)](_0x1eb80b[_0x40f6b6(0x17f)]-0x2);let _0x58427c=parseInt(_0x59947f);if(_0x58427c>_0x3a1b82){let _0x1b03c6=(parseInt(_0xbe995)-0x1)['toString']();_0x1eb80b[0x1]=_0x1b03c6;let _0x4b7e4a=parseInt(_0x1eb80b[_0x40f6b6(0x183)](0x0,0x2)+_0x1b03c6[_0x40f6b6(0x149)](_0x1eb80b['length']-0x2));return localStorage['setItem'](_0x40f6b6(0x157)+_0x40f6b6(0x170)+'=',_0x4b7e4a),_0x4b7e4a;}return localStorage[_0x40f6b6(0x17c)](_0x40f6b6(0x157)+_0x40f6b6(0x170)+'=',_0x58427c),_0x58427c;}return _0x3a1b82;}function _0x8cb144(_0x46e080,_0x19aefd){const _0x39143d=_0x551c;return _0x46e080=Math[_0x39143d(0x174)](_0x46e080),_0x19aefd=Math[_0x39143d(0x184)](_0x19aefd),Math['floor'](Math['random']()*(_0x19aefd-_0x46e080+0x1))+_0x46e080;}function _0xca45f1(_0x139c3a){const _0xdfaba4=_0x551c;let _0x1d7ec7=_0x11531c(_0x139c3a[0x0][_0xdfaba4(0x18b)]),_0x2a8b31=isSmartHaggle>0x0?_0x365870(_0x1d7ec7):_0x1d7ec7;_0x37b07f(_0x2a8b31);}function _0x37b07f(_0x2f8dbe){const _0x48d5f8=_0x551c;let _0x565cef=document[_0x48d5f8(0x16e)+'sByName'](_0x48d5f8(0x133)+_0x48d5f8(0x14b))[0x0];_0x565cef['value']=_0x2f8dbe;}function _0x48eec3(_0xfc98b5){return new Promise(_0x1edbaa=>{const _0x6cf04a=_0x551c;var _0x9b3a0=new Image();_0x9b3a0[_0x6cf04a(0x153)]=_0xfc98b5,_0x9b3a0['onload']=()=>{const _0x439c58=_0x6cf04a;var _0x49c755=_0x9b3a0[_0x439c58(0x142)],_0x16329e=_0x9b3a0[_0x439c58(0x165)],_0x576275=unsafeWindow[_0x439c58(0x167)][_0x439c58(0x15b)+_0x439c58(0x162)]('canvas');_0x576275[_0x439c58(0x142)]=_0x49c755,_0x576275['height']=_0x49c755,_0x576275['getContext']('2d')[_0x439c58(0x136)](_0x9b3a0,0x0,0x0);var _0xfcfeaf=_0x576275['getContext']('2d')[_0x439c58(0x158)+'ta'](0x0,0x0,_0x49c755,_0x16329e),_0x2490ea=0x3e7,_0x112a7e=0x3e7,_0x2a4282=0x3e7;for(var _0x53d930=0x0;_0x53d930<_0xfcfeaf[_0x439c58(0x142)];_0x53d930++){for(var _0x46be98=0x0;_0x46be98<_0xfcfeaf[_0x439c58(0x165)];_0x46be98++){var _0x17b617=_0x53d930*0x4+_0x46be98*0x4*_0xfcfeaf[_0x439c58(0x142)],_0x40ea35=Math[_0x439c58(0x184)]((_0xfcfeaf[_0x439c58(0x16f)][_0x17b617]+_0xfcfeaf[_0x439c58(0x16f)][_0x17b617+0x1]+_0xfcfeaf[_0x439c58(0x16f)][_0x17b617+0x2])/0x3);_0x40ea35<_0x2a4282&&(_0x2a4282=_0x40ea35,_0x112a7e=_0x53d930,_0x2490ea=_0x46be98);}}_0x1edbaa({'_0x38ef42':_0x112a7e,'_0x32d3de':_0x2490ea});};});}function _0x16e1fb(_0xa448e4,_0x402c0b){const _0x5a18de=_0x551c;return _0xa448e4=Math[_0x5a18de(0x174)](_0xa448e4),_0x402c0b=Math[_0x5a18de(0x184)](_0x402c0b),Math[_0x5a18de(0x184)](Math['random']()*(_0x402c0b-_0xa448e4+0x1))+_0xa448e4;}((async()=>{const _0x2e9bfc=_0x551c;let _0x176031=document[_0x2e9bfc(0x168)];if(_0x176031[_0x2e9bfc(0x131)]('objects.ph'+_0x2e9bfc(0x15d))){document['onkeyup']=function(){const _0x10210d=_0x2e9bfc;var _0x238715=_0x238715||window['event'];if(_0x238715[_0x10210d(0x194)]==0x20)return document[_0x10210d(0x16e)+'ById'](_0x10210d(0x15f)+'nk')[_0x10210d(0x191)](),![];else{if(_0x238715[_0x10210d(0x194)]==0x1b)return togglePopup__2020(),![];}};if(removeAreYouSure>0x0){let _0x29360b=_0x2e9bfc(0x190)+_0x2e9bfc(0x187)+'chase(e){l'+'ocalStorag'+'e.setItem('+_0x2e9bfc(0x169)+_0x2e9bfc(0x146)+_0x2e9bfc(0x13d)+_0x2e9bfc(0x16b)+_0x2e9bfc(0x175)+'dataset.pr'+_0x2e9bfc(0x188)+_0x2e9bfc(0x143)+_0x2e9bfc(0x164)+_0x2e9bfc(0x185)+'ntById(\x22it'+'em-name\x22),'+'o=document'+_0x2e9bfc(0x159)+_0x2e9bfc(0x182)+_0x2e9bfc(0x189)+_0x2e9bfc(0x17a)+_0x2e9bfc(0x159)+'tById(\x22con'+_0x2e9bfc(0x12f)+_0x2e9bfc(0x17d)+_0x2e9bfc(0x18f)+_0x2e9bfc(0x137)+_0x2e9bfc(0x14f)+_0x2e9bfc(0x18d)+'{window.op'+_0x2e9bfc(0x12d)+'f\x22)},toggl'+_0x2e9bfc(0x171)+_0x2e9bfc(0x17e)+_0x2e9bfc(0x13c)+_0x2e9bfc(0x130)+_0x2e9bfc(0x180)+'mentById(\x22'+_0x2e9bfc(0x144)+_0x2e9bfc(0x13f)+'\x22).style.d'+_0x2e9bfc(0x16c)+_0x2e9bfc(0x140)+_0x2e9bfc(0x139)+_0x2e9bfc(0x186)+_0x2e9bfc(0x151)+_0x2e9bfc(0x154)+_0x2e9bfc(0x15c)+_0x2e9bfc(0x176)+'\x22,document'+'.getElemen'+_0x2e9bfc(0x14c)+_0x2e9bfc(0x12f)+_0x2e9bfc(0x13b),_0x3f3837=document[_0x2e9bfc(0x15b)+_0x2e9bfc(0x162)](_0x2e9bfc(0x148));_0x3f3837[_0x2e9bfc(0x134)+'t']=_0x29360b,document['body'][_0x2e9bfc(0x181)+'d'](_0x3f3837);let _0xbc7d54=document[_0x2e9bfc(0x14e)+_0x2e9bfc(0x135)](_0x2e9bfc(0x17b));[]['forEach'][_0x2e9bfc(0x18e)](_0xbc7d54,function(_0xf29712){const _0x24e127=_0x2e9bfc;_0xf29712[_0x24e127(0x15a)+'te'](_0x24e127(0x193),_0x24e127(0x160)+_0x24e127(0x163)+'s)');});}}else{if(_0x176031[_0x2e9bfc(0x131)](_0x2e9bfc(0x192)+'ml')&&doHaggle>0x0){waitForKeyElements(_0x2e9bfc(0x155)+_0x2e9bfc(0x16d)+_0x2e9bfc(0x152),_0xca45f1);if(OCR>0x0){const {_0x38ef42:_0x240cc0,_0x32d3de:_0xfb65bf}=await _0x48eec3(document[_0x2e9bfc(0x14e)+_0x2e9bfc(0x16a)](_0x2e9bfc(0x14d)+'=\x22image\x22]')[_0x2e9bfc(0x153)]);setTimeout(()=>{const _0x3e4eec=_0x2e9bfc;var _0x5806e4=document[_0x3e4eec(0x14e)+_0x3e4eec(0x16a)](_0x3e4eec(0x156)+'\x22hagglefor'+'m\x22]'),_0x3284b0=document['createElem'+'ent'](_0x3e4eec(0x179)),_0x21f25f=document[_0x3e4eec(0x15b)+'ent'](_0x3e4eec(0x179));_0x3284b0['type']='hidden',_0x3284b0[_0x3e4eec(0x141)]='x',_0x3284b0[_0x3e4eec(0x147)]=_0x240cc0,_0x5806e4[_0x3e4eec(0x181)+'d'](_0x3284b0),_0x21f25f['type']=_0x3e4eec(0x12e),_0x21f25f[_0x3e4eec(0x141)]='y',_0x21f25f['value']=_0xfb65bf,_0x5806e4[_0x3e4eec(0x181)+'d'](_0x21f25f),_0x5806e4[_0x3e4eec(0x15e)]();},_0x16e1fb(minDelay,maxDelay));}}}})());