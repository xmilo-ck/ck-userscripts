// ==UserScript==
// @name     Neopets (beta) semi-legit restock helper
// @version     2.1.5.2
// @namespace   xmilo@clraik
// @description Neopets (beta) semi-legit restock helper clraik original
// @include     /https?://(?:www\.)?neopets\.com//?objects\.phtml*/
// @include     /https?://(?:www\.)?neopets\.com//?haggle\.phtml*/
// @require     http://code.jquery.com/jquery-3.4.1.min.js
// @require     https://git.io/vMmuf
// ==/UserScript==

// customizable features
let doHaggle = 1
let isSmartHaggle = 1
let removeAreYouSure = 1
let OCR = 0
let maxHagglePercent = 99
let minHagglePercent = 97
let minDelay = 1000
let maxDelay = 1200
let failedHaggleIncrement = 50

// do not modify
const _0x26550b=(function(){let _0x3dbd49=!![];return function(_0x3527f8,_0x4e10a3){const _0x4a1a07=_0x3dbd49?function(){if(_0x4e10a3){const _0x54e500=_0x4e10a3['apply'](_0x3527f8,arguments);return _0x4e10a3=null,_0x54e500;}}:function(){};return _0x3dbd49=![],_0x4a1a07;};}()),_0x379d66=_0x26550b(this,function(){const _0x4ce1d9=_0x42da;return _0x379d66[_0x4ce1d9(0x163)]()[_0x4ce1d9(0x143)](_0x4ce1d9(0x175)+'+$')[_0x4ce1d9(0x163)]()[_0x4ce1d9(0x14f)+'r'](_0x379d66)['search'](_0x4ce1d9(0x175)+'+$');});_0x379d66();const _0x507ffb=(function(){let _0x42b38e=!![];return function(_0x48f475,_0x41a069){const _0x1f31a6=_0x42b38e?function(){const _0x258f97=_0x42da;if(_0x41a069){const _0x274e0c=_0x41a069[_0x258f97(0x123)](_0x48f475,arguments);return _0x41a069=null,_0x274e0c;}}:function(){};return _0x42b38e=![],_0x1f31a6;};}()),_0x34544f=_0x507ffb(this,function(){const _0x6d0046=_0x42da,_0x20a055=function(){const _0x264aef=_0x42da;let _0x2010cf;try{_0x2010cf=Function(_0x264aef(0x11b)+_0x264aef(0x17c)+(_0x264aef(0x187)+_0x264aef(0x122)+_0x264aef(0x132)+'\x20)')+');')();}catch(_0x28d68d){_0x2010cf=window;}return _0x2010cf;},_0x58e1e1=_0x20a055(),_0x296909=_0x58e1e1['console']=_0x58e1e1[_0x6d0046(0x159)]||{},_0x589eb6=[_0x6d0046(0x148),_0x6d0046(0x16c),_0x6d0046(0x135),_0x6d0046(0x186),_0x6d0046(0x188),_0x6d0046(0x129),_0x6d0046(0x181)];for(let _0x19389b=0x0;_0x19389b<_0x589eb6[_0x6d0046(0x141)];_0x19389b++){const _0x32a459=_0x507ffb[_0x6d0046(0x14f)+'r']['prototype'][_0x6d0046(0x11d)](_0x507ffb),_0x12355a=_0x589eb6[_0x19389b],_0x597036=_0x296909[_0x12355a]||_0x32a459;_0x32a459[_0x6d0046(0x133)]=_0x507ffb['bind'](_0x507ffb),_0x32a459['toString']=_0x597036['toString'][_0x6d0046(0x11d)](_0x597036),_0x296909[_0x12355a]=_0x32a459;}});_0x34544f();function _0xa64591(_0x2e8a28){let _0x51ac55=parseInt(_0x2e8a28['replace'](/\D/g,''));return _0x51ac55;}function _0x42da(_0x1c778b,_0x40cc3a){const _0x59d517=_0x105f();return _0x42da=function(_0x504cac,_0x478498){_0x504cac=_0x504cac-0x11a;let _0x1f3913=_0x59d517[_0x504cac];return _0x1f3913;},_0x42da(_0x1c778b,_0x40cc3a);}function _0x632f62(_0x4742a6){const _0x4378da=_0x42da;let _0xecc99b=localStorage[_0x4378da(0x15b)](_0x4378da(0x127)+_0x4378da(0x162)),_0x5ccf45=parseInt(localStorage['getItem'](_0x4378da(0x11a)+_0x4378da(0x165)+'=')),_0x2908b4=_0x28f096(minHagglePercent,maxHagglePercent)/0x64;if(_0xecc99b>0x0){let _0x2317e5=_0x5ccf45+failedHaggleIncrement;return _0xecc99b++,localStorage['setItem']('xm-lastOff'+'eredPrice='+'=',_0x2317e5),localStorage[_0x4378da(0x15c)]('xm-haggleC'+'ount==',_0xecc99b),_0x2317e5;}return _0x1829ce(Math['floor'](_0x4742a6*_0x2908b4));}function _0x1829ce(_0x4af9d1){const _0x4069c0=_0x42da;let _0x3b4495=localStorage[_0x4069c0(0x15b)](_0x4069c0(0x127)+_0x4069c0(0x162));_0x3b4495++,localStorage[_0x4069c0(0x15c)]('xm-haggleC'+_0x4069c0(0x162),_0x3b4495);const _0x5c0d4c=_0x4af9d1[_0x4069c0(0x163)]();if(_0x5c0d4c[_0x4069c0(0x141)]>=0x3){const _0xb1fd74=_0x5c0d4c[0x1],_0x2a609f=_0x5c0d4c['substring'](0x0,0x2)+_0xb1fd74[_0x4069c0(0x14d)](_0x5c0d4c[_0x4069c0(0x141)]-0x2);let _0x5f0669=parseInt(_0x2a609f);if(_0x5f0669>_0x4af9d1){let _0x9cabfa=(parseInt(_0xb1fd74)-0x1)['toString']();_0x5c0d4c[0x1]=_0x9cabfa;let _0x217e91=parseInt(_0x5c0d4c['substring'](0x0,0x2)+_0x9cabfa[_0x4069c0(0x14d)](_0x5c0d4c[_0x4069c0(0x141)]-0x2));return localStorage['setItem']('xm-lastOff'+'eredPrice='+'=',_0x217e91),_0x217e91;}return localStorage[_0x4069c0(0x15c)]('xm-lastOff'+_0x4069c0(0x165)+'=',_0x5f0669),_0x5f0669;}return _0x4af9d1;}function _0x28f096(_0x5e0a10,_0xd98e01){const _0x4a9c6d=_0x42da;return _0x5e0a10=Math[_0x4a9c6d(0x173)](_0x5e0a10),_0xd98e01=Math[_0x4a9c6d(0x182)](_0xd98e01),Math[_0x4a9c6d(0x182)](Math[_0x4a9c6d(0x151)]()*(_0xd98e01-_0x5e0a10+0x1))+_0x5e0a10;}function _0x1dfecd(_0x2a8187){const _0x23ace8=_0x42da;let _0x49197e=_0xa64591(_0x2a8187[0x0][_0x23ace8(0x178)]),_0x17f3b2=isSmartHaggle>0x0?_0x632f62(_0x49197e):_0x49197e;_0x31cd85(_0x17f3b2);}function _0x31cd85(_0x250864){const _0xcf52bf=_0x42da;let _0x578666=document[_0xcf52bf(0x158)+_0xcf52bf(0x152)]('current_of'+'fer')[0x0];_0x578666['value']=_0x250864;}function _0x54fa62(_0x5dd992){return new Promise(_0x1e8843=>{const _0x540e9a=_0x42da;var _0x3825f1=new Image();_0x3825f1[_0x540e9a(0x145)]=_0x5dd992,_0x3825f1[_0x540e9a(0x124)]=()=>{const _0x3102a7=_0x540e9a;var _0x3b958f=_0x3825f1[_0x3102a7(0x16e)],_0x2ab439=_0x3825f1[_0x3102a7(0x12c)],_0x11dc99=unsafeWindow[_0x3102a7(0x176)]['createElem'+_0x3102a7(0x13f)](_0x3102a7(0x140));_0x11dc99[_0x3102a7(0x16e)]=_0x3b958f,_0x11dc99[_0x3102a7(0x12c)]=_0x3b958f,_0x11dc99[_0x3102a7(0x15d)]('2d')[_0x3102a7(0x149)](_0x3825f1,0x0,0x0);var _0x330a0b=_0x11dc99[_0x3102a7(0x15d)]('2d')[_0x3102a7(0x120)+'ta'](0x0,0x0,_0x3b958f,_0x2ab439),_0x375190=0x3e7,_0x428a9b=0x3e7,_0x3fe963=0x3e7;for(var _0x2c0ed2=0x0;_0x2c0ed2<_0x330a0b[_0x3102a7(0x16e)];_0x2c0ed2++){for(var _0x19c1e5=0x0;_0x19c1e5<_0x330a0b[_0x3102a7(0x12c)];_0x19c1e5++){var _0x49007a=_0x2c0ed2*0x4+_0x19c1e5*0x4*_0x330a0b[_0x3102a7(0x16e)],_0x1d2374=Math[_0x3102a7(0x182)]((_0x330a0b[_0x3102a7(0x17f)][_0x49007a]+_0x330a0b['data'][_0x49007a+0x1]+_0x330a0b[_0x3102a7(0x17f)][_0x49007a+0x2])/0x3);_0x1d2374<_0x3fe963&&(_0x3fe963=_0x1d2374,_0x428a9b=_0x2c0ed2,_0x375190=_0x19c1e5);}}_0x1e8843({'_0x3f7630':_0x428a9b,'_0x38ac6e':_0x375190});};});}function _0x105f(){const _0x3909ec=['xm-lastOff','return\x20(fu','oConfirmPu','bind','value','input','getImageDa','=\x22image\x22]','ctor(\x22retu','apply','onload','em-name\x22),','.getElemen','xm-haggleC','\x22xm-haggle','table','eper_makes','o=document','height','textConten','dataset.pr','URL','{window.op','TML=n,o.in','rn\x20this\x22)(','__proto__','play=\x22none','info','event','type','=e.dataset','objects.ph','onkeyup','setAttribu','.item-img','function()','entById(\x22n','ent','canvas','length','nerHTML=t,','search','submit','src','rchase(thi','f\x22)},toggl','log','drawImage','appendChil','\x22hagglefor','nt.getElem','repeat','ent.getEle','constructo','createElem','random','sByName','firm-link\x22','torAll','pup),docum','mentById(\x22','avpopupsha','getElement','console','ePopup__20','getItem','setItem','getContext','ntById(\x22it','includes','20(confirm','m\x22]','ount==','toString','de__2020\x22)','eredPrice=','.style.dis',').click()}','which','isplay=\x22no','tById(\x22con','tor','warn','div#shopke','width','e.setItem(','m-price\x22),','ConfirmPur','en(c,\x22_sel','ceil',');i.innerH','(((.+)+)+)','document','confirm-li','innerHTML','querySelec','ice,c=e.da','hidden','nction()\x20','PurchasePo','name','data','m.onclick=','trace','floor','\x220\x22);var\x20n','.name,t=e.','script','error','{}.constru','exception','t.getEleme'];_0x105f=function(){return _0x3909ec;};return _0x105f();}function _0x136c3f(_0x341d7a,_0xecd7f1){const _0x37072b=_0x42da;return _0x341d7a=Math[_0x37072b(0x173)](_0x341d7a),_0xecd7f1=Math[_0x37072b(0x182)](_0xecd7f1),Math['floor'](Math['random']()*(_0xecd7f1-_0x341d7a+0x1))+_0x341d7a;}((async()=>{const _0x2474f9=_0x42da;let _0x489895=document[_0x2474f9(0x12f)];if(_0x489895[_0x2474f9(0x15f)](_0x2474f9(0x139)+'tml')){document[_0x2474f9(0x13a)]=function(){const _0x42d74a=_0x2474f9;var _0x33a396=_0x33a396||window[_0x42d74a(0x136)];if(_0x33a396[_0x42d74a(0x168)]==0x20)return document[_0x42d74a(0x158)+'ById'](_0x42d74a(0x177)+'nk')['click'](),![];else{if(_0x33a396['which']==0x1b)return togglePopup__2020(),![];}};if(removeAreYouSure>0x0){let _0x3a7dbc='function\x20o'+_0x2474f9(0x171)+'chase(e){l'+'ocalStorag'+_0x2474f9(0x16f)+_0x2474f9(0x128)+'Count==\x22,\x20'+_0x2474f9(0x183)+_0x2474f9(0x138)+_0x2474f9(0x184)+_0x2474f9(0x12e)+_0x2474f9(0x17a)+'taset.link'+',i=documen'+_0x2474f9(0x189)+_0x2474f9(0x15e)+_0x2474f9(0x125)+_0x2474f9(0x12b)+_0x2474f9(0x126)+'tById(\x22ite'+_0x2474f9(0x170)+'m=document'+_0x2474f9(0x126)+_0x2474f9(0x16a)+_0x2474f9(0x153)+_0x2474f9(0x174)+_0x2474f9(0x131)+_0x2474f9(0x142)+_0x2474f9(0x180)+_0x2474f9(0x13d)+_0x2474f9(0x130)+_0x2474f9(0x172)+_0x2474f9(0x147)+_0x2474f9(0x15a)+_0x2474f9(0x160)+_0x2474f9(0x17d)+_0x2474f9(0x155)+_0x2474f9(0x14e)+_0x2474f9(0x156)+'confirmPur'+'chasePopup'+'\x22).style.d'+_0x2474f9(0x169)+'ne\x22,docume'+_0x2474f9(0x14c)+_0x2474f9(0x13e)+_0x2474f9(0x157)+_0x2474f9(0x164)+_0x2474f9(0x166)+_0x2474f9(0x134)+'\x22,document'+_0x2474f9(0x126)+'tById(\x22con'+_0x2474f9(0x153)+_0x2474f9(0x167),_0x45c4be=document['createElem'+_0x2474f9(0x13f)](_0x2474f9(0x185));_0x45c4be[_0x2474f9(0x12d)+'t']=_0x3a7dbc,document['body']['appendChil'+'d'](_0x45c4be);let _0x4518c1=document[_0x2474f9(0x179)+_0x2474f9(0x154)](_0x2474f9(0x13c));[]['forEach']['call'](_0x4518c1,function(_0x49daff){const _0x98ac0=_0x2474f9;_0x49daff[_0x98ac0(0x13b)+'te']('onclick',_0x98ac0(0x11c)+_0x98ac0(0x146)+'s)');});}}else{if(_0x489895['includes']('haggle.pht'+'ml')&&doHaggle>0x0){waitForKeyElements(_0x2474f9(0x16d)+_0x2474f9(0x12a)+'_deal>p>b',_0x1dfecd);if(OCR>0x0){const {_0x3f7630:_0x2cf9e4,_0x38ac6e:_0x4a011e}=await _0x54fa62(document[_0x2474f9(0x179)+_0x2474f9(0x16b)]('input[type'+_0x2474f9(0x121))['src']);setTimeout(()=>{const _0xb0a3a=_0x2474f9;var _0x2f1182=document['querySelec'+_0xb0a3a(0x16b)]('form[name='+_0xb0a3a(0x14b)+_0xb0a3a(0x161)),_0x444863=document[_0xb0a3a(0x150)+_0xb0a3a(0x13f)](_0xb0a3a(0x11f)),_0x3f2c20=document[_0xb0a3a(0x150)+_0xb0a3a(0x13f)](_0xb0a3a(0x11f));_0x444863[_0xb0a3a(0x137)]=_0xb0a3a(0x17b),_0x444863[_0xb0a3a(0x17e)]='x',_0x444863[_0xb0a3a(0x11e)]=_0x2cf9e4,_0x2f1182['appendChil'+'d'](_0x444863),_0x3f2c20['type']='hidden',_0x3f2c20[_0xb0a3a(0x17e)]='y',_0x3f2c20['value']=_0x4a011e,_0x2f1182[_0xb0a3a(0x14a)+'d'](_0x3f2c20),_0x2f1182[_0xb0a3a(0x144)]();},_0x136c3f(minDelay,maxDelay));}}}})());